<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Amaterasu</title>
    <style>
        body {
            text-align: center;
            background-image: url("https://i.imgur.com/UocIPRm.jpg");
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            color: white;
        }

        .grafico-container {
            display: inline-block;
            margin: 10px;
            border: 1px solid #f5eded;
            padding: 10px;
            background-color: #404040; /* Cor de chumbo */
            color: white; /* Texto branco */
        }

        .center {
            text-align: center;
        }

        .button-center {
            display: flex;
            justify-content: center;
        }

        .chart-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
</head>
<body>
    <h1 class="center">Medidor de humor 0 igual a nível baixo e 4 é extremo</h1>

    <div id="login-container" class="center">
        <h3>Login</h3>
        <input type="email" id="email" placeholder="Email" required>
        <br>
        <input type="password" id="password" placeholder="Password" required>
        <br>
        <button onclick="login()">Login</button>
    </div>

    <div id="content-container" style="display: none;">
        <label for="titulo" style="color: white;">Título do Gráfico:</label>
        <br>
        <input type="text" id="titulo" placeholder="Digite o título">
        <br>
        <p style="color: white;">Clique no botão para adicionar um novo dado:</p>
        <div class="button-center">
            <button onclick="gerarGrafico()" id="gerar-grafico">Gerar Gráfico</button>
        </div>
        <br>
        <div id="graficos-container"></div>
    </div>

    <script>
        // Initialize Firebase with your project's configuration
        var firebaseConfig = {
                apiKey: "AIzaSyCTsB2tzgpaVYlIZxkd3ZJRtKbeEcg9dyM",
                authDomain: "amaterasu-34620.firebaseapp.com",
                projectId: "amaterasu-34620",
                storageBucket: "amaterasu-34620.appspot.com",
                messagingSenderId: "315328239657",
                appId: "1:315328239657:web:84c09e45882663d4e1a438",
                measurementId: "G-HVSNTXB2NR
        };

        firebase.initializeApp(firebaseConfig);

        // Login function
        function login() {
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(function (userCredential) {
                    // Login successful
                    var user = userCredential.user;
                    document.getElementById('login-container').style.display = 'none';
                    document.getElementById('content-container').style.display = 'block';
                })
                .catch(function (error) {
                    // Login error
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    console.error(errorCode, errorMessage);
                    alert('Login failed. Please check your credentials.');
                });
        }

        var graficos = [];
        var limiteGraficos = 4;
        var valorMaximo = 4;

        function adicionarDado(graficoIndex) {
            var valorInput = document.getElementById('valor-' + graficoIndex);
            var valor = parseInt(valorInput.value);

            if (Number.isInteger(valor) && valor >= 0 && valor <= valorMaximo) {
                var grafico = graficos[graficoIndex];
                grafico.dados.push(valor);
                atualizarGrafico(grafico);
                valorInput.value = ''; // Limpa o campo de entrada
            } else {
                alert('Insira um número inteiro entre 0 e ' + valorMaximo + '.');
                valorInput.value = ''; // Limpa o campo de entrada em caso de valor inválido
            }
        }

        function gerarGrafico() {
            if (graficos.length >= limiteGraficos) {
                document.getElementById('gerar-grafico').disabled = true;
                return;
            }

            var titulo = document.getElementById('titulo').value;
            if (titulo !== '') {
                var novoGrafico = {
                    titulo: titulo,
                    dados: [],
                    finalizado: false
                };
                graficos.push(novoGrafico);
                document.getElementById('titulo').value = '';
                adicionarGraficoHTML(novoGrafico);
            }
        }

        function adicionarGraficoHTML(grafico) {
            var graficoContainer = document.createElement('div');
            graficoContainer.className = 'grafico-container';
            graficoContainer.innerHTML = '<h3>' + grafico.titulo + '</h3><canvas id="grafico-canvas-' + graficos.indexOf(grafico) + '"></canvas>' +
                '<label for="valor-' + graficos.indexOf(grafico) + '">Valor:</label>' +
                '<input type="number" id="valor-' + graficos.indexOf(grafico) + '" min="0" max="' + valorMaximo + '" placeholder="Digite o valor">' +
                '<div class="button-center">' +
                '<button onclick="adicionarDado(' + graficos.indexOf(grafico) + ')">Adicionar</button>' +
                '</div>' +
                '<div class="chart-buttons">' +
                '<button onclick="salvarGrafico(' + graficos.indexOf(grafico) + ')">Salvar Gráfico</button>' +
                '</div>';
            document.getElementById('graficos-container').appendChild(graficoContainer);
            atualizarGrafico(grafico);
        }

        function atualizarGrafico(grafico) {
            var canvasId = 'grafico-canvas-' + graficos.indexOf(grafico);
            var ctx = document.getElementById(canvasId).getContext('2d');
            var data = {
                labels: [...Array(grafico.dados.length).keys()].map(x => x + 1),
                datasets: [{
                    label: 'Valores',
                    data: grafico.dados,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            };

            var options = {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: valorMaximo
                    }
                }
            };

            if (grafico.chart) {
                grafico.chart.destroy();
            }

            grafico.chart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: options
            });
        }

        function salvarGrafico(graficoIndex) {
            var graficoCanvas = document.getElementById('grafico-canvas-' + graficoIndex);
            var imageBase64 = graficoCanvas.toDataURL("image/png");

            var link = document.createElement('a');
            link.href = imageBase64;
            link.download = 'grafico.png';
            link.click();
        }
    </script>
</body>
</html>
